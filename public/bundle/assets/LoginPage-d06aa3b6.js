import{p as D}from"./policy-bc46909d.js";import{A as O,M as W,a as G}from"./AuthErrors-d335e0f9.js";import{M as F}from"./MainTitle-5abaae33.js";import{M as B}from"./MainPopup-3ac77bbe.js";import{M as S}from"./MainDescriptionOld-8ed807b9.js";import{M as H}from"./MainCopy-b48a6063.js";import{M as x}from"./MainButton-069506c4.js";import{m as $,_ as P,r,o as h,g as M,h as p,a as i,d as a,b as m,t as d,n as b,c as y,j as U,q as Q,B as C,i as J,w as V,J as Z,F as I,k as K,C as k,M as L,L as X,p as Y,e as ee}from"./app-7a3a58ff.js";import{S as se,P as te}from"./ProfilePassword-a211b840.js";import{M as E,V as oe}from"./ValidateService-56a5ee18.js";import{a as q,b as N,V as re}from"./VerifyLink-301fc5ba.js";import{M as z}from"./MainInput-7e1d9d63.js";import{A as ae}from"./AuthMessages-57a1dce6.js";/* empty css                                                                  */import"./anime.es-de4e5aa0.js";import"./TickIcon-df7ac9c5.js";import"./MainIcon-57980112.js";const ie={name:"PasswordPopup",props:{opened:Boolean,closed:Boolean,wait:Boolean,validateService:Object},i18n:{sharedMessages:se},data(){return{form:{password:"",password_confirmation:""},makeResize:!1,validateInputs:!1,sendButton:!0,errorMassage:""}},watch:{"form.password"(e,s){setTimeout(()=>{this.makeResize=!0,setTimeout(()=>this.makeResize=!1,50)},355),Object.keys(this.validateService.validate).length!==0&&e!==s&&(this.validateInputs=!1,this.sendButton=!0),this.validateInputs&&e!==s&&(this.validateInputs=!1)},"form.password_confirmation"(e,s){this.validateInputs&&e!==s&&(this.validateInputs=!1),e&&Object.keys(this.validateService.validate).length===0&&(this.sendButton=!1)}},computed:{...$(["errorsExpired"])},components:{MainValidate:E,ProfilePassword:te,MainDescription:S,MainPopup:B,MainTitle:F,MainCopy:H,MainButton:x},methods:{closePopup(){this.form.password!==this.form.password_confirmation&&(this.validateInputs=!0,this.errorMassage=this.$t("error.password-confirmation")),this.form.password===this.form.password_confirmation&&Object.keys(this.validateService.validate).length===0&&this.form.password.length>0&&!this.validateInputs?this.$emit("sendPassword",this.form):this.validateInputs=!0},changePasswordForm(e,s){const t=s.target?s.target.value:s;this.form[e]=t,this.$emit("changePassword",this.form),this.validateService.validateProcess(this.form.password)}}},ne={class:"password__head"};function le(e,s,t,c,o,n){const l=r("main-title"),w=r("main-description"),f=r("profile-password"),_=r("main-validate"),v=r("main-button"),T=r("main-popup");return h(),M(T,{id:"password",ref:"password",opened:t.opened,closed:t.closed,"make-resize":o.makeResize},{default:p(()=>[i("div",ne,[a(l,null,{default:p(()=>[m(d(e.$t("password_popup.title")),1)]),_:1}),a(w,null,{default:p(()=>[m(d(e.$t("password_popup.description-two")),1)]),_:1})]),i("form",{class:"password__content",onSubmit:s[2]||(s[2]=C((...g)=>n.closePopup&&n.closePopup(...g),["prevent"]))},[a(f,{class:b(["password_input",{"not-validate":o.validateInputs}]),name:"password",placeholder:e.$t("password_popup.placeholders.new_password"),model:o.form.password,onChangeValue:s[0]||(s[0]=g=>n.changePasswordForm("password",g))},null,8,["placeholder","model","class"]),a(_,{validate:t.validateService.validate},null,8,["validate"]),a(f,{class:b(["password_input password_input-last",{"not-validate":o.validateInputs}]),name:"password",placeholder:e.$t("password_popup.placeholders.confirm_password"),model:o.form.password_confirmation,onChangeValue:s[1]||(s[1]=g=>n.changePasswordForm("password_confirmation",g))},null,8,["placeholder","model","class"]),a(Q,{name:"error"},{default:p(()=>[o.validateInputs?(h(),y("span",{key:0,class:b(["password_error",{"active-error":o.errorMassage.length}])},d(e.$t("error.password-confirmation")),3)):U("",!0)]),_:1}),a(v,{type:"submit",class:b(["button-blue password_button button-full",{"active-disableed":o.sendButton}]),disabled:o.sendButton,wait:t.wait},{text:p(()=>[m(d(e.$t("password_popup.button")),1)]),_:1},8,["disabled","wait","class"])],32)]),_:1},8,["opened","closed","make-resize"])}const pe=P(ie,[["render",le],["__scopeId","data-v-ae317a4a"]]),de={name:"VerifyPopup",components:{MainInput:z,MainValidate:E,MainPopup:B,MainTitle:F,MainDescription:S,MainButton:x},props:{wait:Boolean,closed:Boolean,opened:Boolean},i18n:q,data(){return{service:new N}},methods:{sendEmailMessage(){}}};function ce(e,s,t,c,o,n){const l=r("main-popup");return h(),M(l,{id:"verify",wait:t.wait,closed:t.closed,opened:t.opened},{default:p(()=>[J(e.$slots,"default")]),_:3},8,["wait","closed","opened"])}const ue=P(de,[["render",ce]]);const me={name:"input-section",props:{index:Number,length:Number,focus:Number},data(){return{number:""}},watch:{focus(e){e&&this.$refs.input.focus()},number(e,s){e.length===0&&s.length>0||(e.length<=1?this.$emit("setNumber",{index:this.index+1,value:e}):this.number=s)}},methods:{keyHandler(e){e.keyCode===8&&this.$emit("getBack",this.index-1)}},mounted(){this.$refs.input.addEventListener("keydown",this.keyHandler)},unmounted(){this.$refs.input&&this.$refs.input.removeEventListener("keydown",this.keyHandler)}};function he(e,s,t,c,o,n){return V((h(),y("input",{type:"text",class:b(["input_section",{"input-opacity":t.length===t.index}]),ref:"input","onUpdate:modelValue":s[0]||(s[0]=l=>o.number=l)},null,2)),[[Z,o.number]])}const fe=P(me,[["render",he],["__scopeId","data-v-6f6e1a26"]]);const _e={name:"two-fac-input",props:{inputLabel:String},components:{InputSection:fe},data(){return{sections:[{focus:!0},{focus:!1},{focus:!1},{focus:!1},{focus:!1},{focus:!1},{focus:!1}],form:{two_fa_secret:""}}},methods:{setFocus(e){this.sections.forEach(s=>s.focus=!1),e>=0&&e<=this.sections.length-1&&(this.sections[e].focus=!0)},getValue(e){this.setFocus(e.index),e.index!==this.sections.length-1&&(this.form.two_fa_secret+=e.value)}},watch:{two_fa_secret(e){this.$emit("getSecret",e)}}},we={class:"row"},ve={class:"row_label"},ge={class:"row_input"};function Pe(e,s,t,c,o,n){const l=r("input-section");return h(),y("div",we,[i("label",ve,d(t.inputLabel),1),i("div",ge,[(h(!0),y(I,null,K(o.sections,(w,f)=>(h(),M(l,{key:f,index:f,length:o.sections.length-1,focus:w.focus,onSetNumber:s[0]||(s[0]=_=>n.getValue(_)),onGetBack:s[1]||(s[1]=_=>n.setFocus(_))},null,8,["index","length","focus"]))),128))])])}const be=P(_e,[["render",Pe],["__scopeId","data-v-717bb090"]]);const ye={name:"TwoFacForm",props:{title:Boolean,text:Boolean,placeholder:Boolean,button_text:Boolean,wait:{type:Boolean,default:!1}},computed:{...$(["user"])},i18n:{sharedMessages:q},components:{TwoFacInput:be,MainInput:z,MainTitle:F,MainDescription:S,MainButton:x},data(){return{service:new N}},methods:{sendFormWithCode(){this.wait||this.$emit("sendForm",this.service.form.code)}}},ke={class:"verify__head"};function Fe(e,s,t,c,o,n){const l=r("main-title"),w=r("main-description"),f=r("main-input"),_=r("main-button");return h(),y(I,null,[i("div",ke,[a(l,null,{default:p(()=>[m(d(e.$t(t.title)),1)]),_:1}),a(w,null,{default:p(()=>[m(d(e.$t(t.text)),1)]),_:1})]),i("form",{class:"verify__content",onSubmit:s[1]||(s[1]=C((...v)=>n.sendFormWithCode&&n.sendFormWithCode(...v),["prevent"]))},[a(f,{class:"verify_input","input-name":"code","input-label":e.$t(t.placeholder),"input-value":o.service.form.code,onGetValue:s[0]||(s[0]=v=>o.service.form.code=v)},null,8,["input-label","input-value"]),a(_,{class:"button-blue verify_button button-full",type:"submit",wait:t.wait},{text:p(()=>[m(d(e.$t(t.button_text)),1)]),_:1},8,["wait"])],32)],64)}const xe=P(ye,[["render",Fe],["__scopeId","data-v-bd3adb29"]]);class Me{constructor(s,t,c){this.email=s,this.password=t,this.remember=c}}class Te{constructor(s,t){this.form={},this.checkbox=!1,this.translate=null,this.router=s,this.route=t,this.openedPasswordPopup=!1,this.closedPasswordPopup=!1,this.openedTwoFacPopup=!1,this.closedTwoFacPopup=!1,this.validate={},this.validateService=new oe,this.waitLogin=!1,this.waitPasswordChange=!1}setTranslate(s){this.translate=s}setForm(){this.form={...new Me("","",!0)}}removeRouteQuery(){this.router.push({name:"login"})}validateProcess(s){this.validate=this.validateService.validateProcess(s,this.form,this.validate)}async sendPassword(s){this.waitPasswordChange=!0;try{const t={...s,email:this.route.query.email,hash:this.route.query.hash},c=await this.fetchPassword(t);this.closePasswordPopup(),this.removeRouteQuery(),k.dispatch("setNotification",{status:"success",title:"changed",text:c.message}),this.waitPasswordChange=!1}catch(t){this.waitPasswordChange=!1,console.error(t),k.dispatch("setNotification",{status:"error",title:"error",text:t.response.data.error??t.response.data.message})}}async fetchPassword(s){return(await L.put(`/password/restore/${this.route.query.user_id}`,s)).data}openPasswordPopup(){this.openedPasswordPopup=!0,setTimeout(()=>this.openedPasswordPopup=!1,300)}closePasswordPopup(){this.closedPasswordPopup=!0,setTimeout(()=>this.closedPasswordPopup=!1,300)}openTwoFacPopup(){this.openedTwoFacPopup=!0,setTimeout(()=>this.openedTwoFacPopup=!1,300)}closeTwoFacPopup(){this.closedTwoFacPopup=!0,setTimeout(()=>this.closedTwoFacPopup=!1,300)}async login(){var s;this.waitLogin=!0;try{const t=await L.post("/login",this.form),c=t.data.user,o=t.data.token;k.dispatch("setToken",o),k.dispatch("setUser",c),this.router.push({name:"statistic",query:{...((s=this.route.query)==null?void 0:s.action)==="email"?{onboarding:!0}:{}}}),this.closeTwoFacPopup(),this.waitLogin=!1}catch(t){if(console.error(t),this.waitLogin=!1,k.dispatch("setFullErrors",{...t.response.data.errors}),t.response.status===403){if(t.response.data.errors.messages[0]==="Pass 2fa code!"||t.response.data.errors.messages[0]==="Введите код")return this.openTwoFacPopup(),this;this.router.push({name:"confirm",query:{email:this.form.email}})}}}}const Se={name:"LoginForm",components:{TwoFacForm:xe,VerifyPopup:ue,VerifyLink:re,AuthInput:O,MainPassword:W,AuthErrors:G,MainTitle:F,MainButton:x,PasswordPopup:pe},i18n:{sharedMessages:ae},computed:{...$(["errors","errorsExpired"])},data(){return{pdf:D,service:new Te(this.$router,this.$route)}},watch:{"$i18n.locale"(){this.service.setTranslate(this.$t)}},mounted(){var e,s;this.service.setForm(),((e=this.$route.query)==null?void 0:e.action)==="password"&&this.openPasswordPopup(),((s=this.$route.query)==null?void 0:s.action)==="email"&&(this.$store.dispatch("setNotification",{status:"success",title:"success",text:this.$t("validate_messages.verify_message")}),this.$router.push({name:"login"})),this.$t&&this.service.setTranslate(this.$t)},methods:{async loginWithSecretCode(e){this.service.waitLogin||(this.service.form.google2fa_code=e,await this.service.login())},async sendPassword(e){this.service.waitPasswordChange||await this.service.sendPassword(e)},async openPasswordPopup(){await this.service.openPasswordPopup()}}},$e=e=>(Y("data-v-14f6747d"),e=e(),ee(),e),Ce={class:"form-auth__content"},Ie={for:"checkbox"},Le=$e(()=>i("div",{class:"fake"},[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M9.50538 18L4 12.2809L5.05684 11.183L9.50538 15.8043L18.9432 6L20 7.09787L9.50538 18Z",fill:"#7C7C7C"}),i("rect",{x:"0.5",y:"0.5",width:"23",height:"23",rx:"3.5",stroke:"#7C7C7C"})])],-1)),Be={class:"form-auth__block"},Ve={class:"text text-light form-auth_text"};function Ee(e,s,t,c,o,n){const l=r("main-title"),w=r("auth-errors"),f=r("auth-input"),_=r("main-password"),v=r("main-button"),T=r("verify-link"),g=r("router-link"),j=r("password-popup"),A=r("two-fac-form"),R=r("verify-popup");return h(),y(I,null,[i("form",{class:"form-auth",onSubmit:s[3]||(s[3]=C((...u)=>o.service.login&&o.service.login(...u),["prevent"]))},[a(l,{class:"form-auth_title"},{default:p(()=>[m(d(e.$t("auth.login.title")),1)]),_:1}),a(w,{errors:e.errors},null,8,["errors"]),i("div",Ce,[a(f,{error:e.errorsExpired.messages??e.errorsExpired.email,model:o.service.form.email,placeholder:e.$t("auth.login.placeholders[0]"),name:"email",type:"email",autocomplete:"username",onChangeInput:s[0]||(s[0]=u=>o.service.form.email=u)},null,8,["error","model","placeholder"]),i("div",{class:b(["form-auth_row password_row",{error:e.errorsExpired.error}])},[a(_,{name:"password",placeholder:e.$t("auth.login.placeholders[1]"),model:o.service.form.password,error:e.errorsExpired.messages??e.errorsExpired.password,autocomplete:"current-password",onChangeInput:s[1]||(s[1]=u=>o.service.form.password=u)},null,8,["placeholder","model","error"])],2)]),V(i("input",{id:"checkbox","onUpdate:modelValue":s[2]||(s[2]=u=>o.service.form.remember=u),class:"form-auth_checkbox",type:"checkbox"},null,512),[[X,o.service.form.remember]]),i("label",Ie,[Le,i("span",null,d(e.$t("auth.login.checkbox")),1)]),i("div",Be,[a(v,{class:"form-auth_button button-xl auth",wait:o.service.waitLogin,type:"submit"},{text:p(()=>[m(d(e.$t("auth.login.button")),1)]),_:1},8,["wait"]),a(T,{class:"form-auth_forgot-password","verify-url":"/password/forgot","verify-text":e.$t("auth.login.reset"),data:o.service.form},null,8,["verify-text","data"])]),i("p",Ve,[m(d(e.$t("auth.login.link[0]"))+" ",1),a(g,{to:{name:"registration"},class:"form-auth_link"},{default:p(()=>[m(d(e.$t("auth.login.link[1]")),1)]),_:1})])],32),a(j,{opened:o.service.openedPasswordPopup,wait:o.service.waitPasswordChange,closed:o.service.closedPasswordPopup,"validate-service":o.service,onSendPassword:s[4]||(s[4]=u=>n.sendPassword(u))},null,8,["opened","wait","closed","validate-service"]),a(R,{closed:o.service.closedTwoFacPopup,opened:o.service.openedTwoFacPopup},{default:p(()=>[a(A,{title:"form.fac.title",text:"form.fac.text",placeholder:"form.fac.placeholder",button_text:"form.fac.button_text",wait:o.service.waitLogin,onSendForm:s[5]||(s[5]=u=>n.loginWithSecretCode(u))},null,8,["wait"])]),_:1},8,["closed","opened"])],64)}const qe=P(Se,[["render",Ee],["__scopeId","data-v-14f6747d"]]),Ne={name:"LoginPage",components:{LoginForm:qe},props:{errors:Object},mounted(){document.title=this.$t("auth.login.head")}};function ze(e,s,t,c,o,n){const l=r("login-form");return h(),M(l,{errors:t.errors},null,8,["errors"])}const ts=P(Ne,[["render",ze]]);export{ts as default};
