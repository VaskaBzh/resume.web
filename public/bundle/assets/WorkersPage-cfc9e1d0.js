import{m as T,_ as k,r as a,o as h,c as w,d as i,h as l,a as u,w as M,v as $,t as m,n as W,q as f,j as b,g as C,i as H,F as P,k as F,C as v,P as I,T as O,b as j}from"./app-7a3a58ff.js";import{I as V}from"./CabinetCard-9f91989e.js";import{M as B,D as x}from"./MinuteHashrateIcon-95aec08f.js";import{M as L}from"./MainSlider-cf396ea1.js";import{M as z}from"./MainTable-a3e08966.js";import{M as K}from"./MainPreloader-edb92089.js";import{M as q}from"./MainTabs-a2f87367.js";import{W as J,M as Q}from"./WaitPreloader-358f9559.js";import{M as U}from"./MainTitle-5abaae33.js";import{M as X}from"./MainPopup-3ac77bbe.js";import{W as Y}from"./WatchersMessages-3b1bfe4c.js";import{a as Z,I as R}from"./InstructionService-d77d7f22.js";import{I as ee}from"./InstructionButton-391a8821.js";import"./TooltipCard-430f11e3.js";import"./StatesService-a0d6c34c.js";import"./anime.es-de4e5aa0.js";import"./transform-fa9976d2.js";/* empty css                                                                  */const te={components:{CabinetCard:V,MinuteHashrateIcon:B,DayHashrateIcon:x},computed:{...T(["getAccount"])}},se={class:"cards"};function re(r,e,s,c,t,o){const n=a("minute-hashrate-icon"),_=a("cabinet-card"),d=a("day-hashrate-icon");return h(),w("div",se,[i(_,{title:r.$t("statistic.info_blocks.hash.titles[0]"),value:r.getAccount.hash_per_min??0,unit:`${r.getAccount.hash_per_min_unit??"T"}H/s`,page:"worker"},{svg:l(()=>[i(n)]),_:1},8,["title","value","unit"]),i(_,{title:r.$t("statistic.info_blocks.hash.titles[1]"),value:r.getAccount.hash_per_day??0,unit:`${r.getAccount.hash_per_day_unit??"T"}H/s`,page:"worker"},{svg:l(()=>[i(d)]),_:1},8,["title","value","unit"])])}const ie=k(te,[["render",re],["__scopeId","data-v-cdcd30cc"]]),ae={name:"cross-icon"},oe={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ne=u("path",{d:"M19 5L5 19M5 5L19 19",stroke:"#D0D5DD","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),ce=[ne];function le(r,e,s,c,t,o){return h(),w("svg",oe,ce)}const _e=k(ae,[["render",le]]),E={en:{all:"All",active:"Active",inactive:"Inactive",dead:"Archive","status-worker":{title:{ACTIVE:"ACTIVE",INACTIVE:"INACTIVE",DEAD:"ARCHIVE"}}},ru:{all:"Все",active:"Активные",inactive:"Неактивные",dead:"Архив","status-worker":{title:{ACTIVE:"АКТИВНЫЙ",INACTIVE:"НЕ АКТИВНЫЙ",DEAD:"АРХИВНЫЙ"}}}};const ue={name:"WorkerCard",components:{WaitPreloader:J,DayHashrateIcon:x,MinuteHashrateIcon:B,CrossIcon:_e,MainTabs:q,MainLineGraph:Q,CabinetCard:V},props:{target_worker:Object,graph:Object,wait:Boolean},i18n:{sharedMessages:E},data(){return{height:190}},computed:{...T(["viewportWidth"]),hashPerDay(){return this.wait?null:Number(this.target_worker.hashrate.split(" ")[0]).toFixed(2)},hashPerMin(){return this.wait?null:Number(this.target_worker.hashrate_per_day.split(" ")[0]).toFixed(2)}}},he={class:"card"},de={class:"card__wrapper"},pe={class:"card__content"},we={class:"card__head"},ve={class:"card_title"},ke={key:0,class:"card_graph"},me={class:"card__block"};function ge(r,e,s,c,t,o){const n=a("wait-preloader"),_=a("cross-icon"),d=a("main-line-graph"),y=a("minute-hashrate-icon"),g=a("cabinet-card"),A=a("day-hashrate-icon");return h(),w("div",he,[i(n,{class:"card_preloader",wait:s.wait,interval:20,end:!s.wait},null,8,["wait","end"]),u("div",de,[u("div",pe,[i(f,{name:"fade"},{default:l(()=>[M(u("div",we,[u("h3",ve,m(s.target_worker.name),1),u("span",{class:W(["card_status",{"card_status-active":s.target_worker.class==="ACTIVE","card_status-in-active":s.target_worker.class==="INACTIVE","card_status-dead":s.target_worker.class==="DEAD"}])},m(r.$t(`status-worker.title.${s.target_worker.class}`)),3)],512),[[$,!s.wait]])]),_:1}),i(_,{class:"card_close",onClick:e[0]||(e[0]=S=>r.$emit("closeCard"))}),i(f,{name:"fade"},{default:l(()=>[s.wait?b("",!0):(h(),w("div",ke,[i(d,{"graph-data":s.graph,height:t.height},null,8,["graph-data","height"])]))]),_:1}),i(f,{name:"fade"},{default:l(()=>[M(u("div",me,[i(g,{class:"card__elem",title:r.$t("statistic.info_blocks.hash.titles[0]"),value:o.hashPerDay,unit:"TH/s",page:"worker"},{svg:l(()=>[i(y)]),_:1},8,["title","value"]),i(g,{class:"card__elem",title:r.$t("statistic.info_blocks.hash.titles[1]"),value:o.hashPerMin,unit:"TH/s",page:"worker"},{svg:l(()=>[i(A)]),_:1},8,["title","value"])],512),[[$,!s.wait]])]),_:1})])])])}const fe=k(ue,[["render",ge],["__scopeId","data-v-9162a317"]]);const be={name:"workers-popup-card",components:{MainPopup:X},props:{wait:Boolean,closed:Boolean,opened:Boolean},i18n:{sharedMessages:Y},computed:{...T(["errorsExpired"])}};function Ce(r,e,s,c,t,o){const n=a("main-popup");return h(),C(n,{id:"cardWorker",wait:s.wait,closed:s.closed,opened:s.opened,onClosed:e[0]||(e[0]=_=>r.$emit("dropWorkers"))},{default:l(()=>[H(r.$slots,"default")]),_:3},8,["wait","closed","opened"])}const We=k(be,[["render",Ce]]);const Te={name:"worker-tabs",props:{tabs:Array,active_tab:String},i18n:{sharedMessages:E}},ye={class:"tabs"},Ae=["onClick"];function Se(r,e,s,c,t,o){return h(),w("div",ye,[(h(!0),w(P,null,F(s.tabs,(n,_)=>(h(),w("div",{class:W(["tab",{"tab-active":n.value===s.active_tab}]),key:_,onClick:d=>r.$emit("changeStatus",n.value)},m(r.$t(n.name))+" ("+m(n.count??0)+") ",11,Ae))),128))])}const Ie=k(Te,[["render",Se],["__scopeId","data-v-f12f0431"]]);class D{constructor(e){this.class=e.status||e.worker_status,this.name=e.worker_name,this.name=String(this.name).split(".")[1],this.hashrate=`${e.shares_1m} ${e.shares_unit}h/s`,this.hashrate_per_day=`${e.shares_1d} ${e.shares_1d_unit}h/s`,this.reject_percent=`${Number(e.reject_percent).toFixed(0)} %`,this.graphId=e.worker_id,this.data="#seeChart"}}class Me{constructor(e){this.hashrate=e.hash,this.unit=e.unit}}class $e{constructor(e,s,c){this.group_id=v.getters.getActive,this.worker_id=-1,this.translate=e,this.titles=[],this.titleIndexes=s,this.rows=[],this.workers_graph={},this.records=[],this.filterButtons=[],this.status="all",this.table=new Map,this.waitWorkers=!0,this.emptyTableWorkers=!1,this.popupCardOpened=!1,this.popupCardClosed=!1,this.target_worker={},this.waitTargetWorker=!0,this.visibleCard=!1,this.route=c}useTranslater(e){this.titles=e.map(s=>this.translate(`workers.table.thead[${s}]`))}updateGroup_id(){this.group_id=v.getters.getActive}async fillTable(){this.updateGroup_id(),await this.getList(),this.group_id!==-1&&(this.table.set("titles",this.titles),this.table.set("rows",this.rows))}clearWorkerId(){this.worker_id=-1}setStatus(e){return this.status=e,this}setFilterButtons(){var o,n,_,d;let e=(o=v.getters.getAccount)==null?void 0:o.workers_count_active,s=(n=v.getters.getAccount)==null?void 0:n.workers_count_in_active,c=(_=v.getters.getAccount)==null?void 0:_.workers_count_unstable,t=(d=v.getters.getAccount)==null?void 0:d.workers_count;return this.filterButtons=[{name:"all",value:"all",count:t},{name:"active",value:"active",count:e},{name:"inactive",value:"inactive",count:s},{name:"dead",value:"dead",count:c}],this}async fetchList(){return await I.get(`/workers/${this.group_id}?per_page=1000&status=${this.status}`)}async fetchWorker(){return await I.get(`/workers/worker/${this.worker_id}`)}async fetchWorkerGraph(){return await I.get(`/workerhashrate/${this.worker_id}`)}clearTable(){this.table={}}async getList(){if(this.group_id!==-1){this.useTranslater(this.titleIndexes),this.emptyTableWorkers=!1,this.waitWorkers=!0;try{this.rows=(await this.fetchList()).data.data.map(e=>new D({...e})),this.rows.length===0&&(this.emptyTableWorkers=!0),this.waitWorkers=!1}catch(e){console.error(`Error with: ${e}`)}}}setButtons(){this.buttons=[{title:`24 ${this.translate("hours")}`,value:24},{title:`7 ${this.translate("days")}`,value:168}]}async getWorker(){this.group_id!==-1&&(this.waitTargetWorker=!0,Object.assign(this.target_worker,new D({...(await this.fetchWorker()).data.data})))}dropWorker(){this.target_worker={},this.visibleCard=!1,this.waitTargetWorker=!0}setGraphTitles(){return[0,1].map(e=>this.translate(`chart.labels[${e}]`))}setDates(){const e=new Date().getTime(),s=60*60*1e3;return Array.from({length:24},(c,t)=>new Date(e-(23-t)*s).getTime())}setDefaultKeys(){this.workers_graph={...this.workers_graph,title:this.setGraphTitles(),dates:this.setDates()}}randomizeTest(e,s){return Math.random()*(s-e)+e}async makeFullValues(){const[e,s]=this.records.slice(-24).reduce((c,t)=>(c[0].push(t.hashrate||0),c[1].push(t.unit||"T"),c),[[],[],[]]);for(;e.length<24;)e.push(0),s.push("T");Object.assign(this.workers_graph,{values:e.reverse(),unit:s.reverse()})}openPopupCard(){this.popupCardOpened=!0,setTimeout(()=>{this.popupCardOpened=!1},300)}closePopupCard(){this.popupCardClosed=!0,setTimeout(()=>{this.popupCardClosed=!1},300)}async getPopup(e){this.visibleCard=!0,this.updateGroup_id(),this.worker_id=e,await this.setDefaultKeys(),this.openPopupCard(),await this.getWorkerGraph(),await this.makeFullValues(),await this.getWorker(),this.waitTargetWorker=!1}async getWorkerGraph(){if(this.group_id!==-1){this.waitTargetWorker=!0;try{this.records=(await this.fetchWorkerGraph()).data.data.map(e=>new Me({...e}))}catch(e){console.error(`Error with: ${e}`)}}}}const De={components:{WorkerTabs:Ie,InstructionButton:ee,MainHashrateCards:ie,MainSlider:L,MainTable:z,MainPreloader:K,WorkerCard:fe,MainTitle:U,WorkersPopupCard:We,InstructionStep:Z},data(){return{workersActive:0,workersInActive:0,workersDead:0,changedActive:-1,removePercent:!1,waitAnimation:!1,waitTimeout:null,worker_service:new $e(this.$t,[0,1,3,4],this.$route),instructionService:new R,isMounted:!1}},watch:{getActive(r,e){this.changedActive=e===-1?-1:r,this.initWorkers()},"$i18n.locale"(){this.initWorkers(),document.title=this.$t("header.links.workers")},getAccount:{deep:!0,handler(r){r&&this.worker_service.setFilterButtons()}}},methods:{setStatus(r){this.worker_service.setStatus(r),this.initWorkers()},async initWorkers(){await this.worker_service.fillTable()},async getTargetWorker(r){clearTimeout(this.waitTimeout),this.viewportWidth>1200&&(this.removePercent=!0),this.waitAnimation=!0,this.waitTimeout=setInterval(()=>{this.waitAnimation=!1},this.viewportWidth>1200?550:1050),await this.worker_service.getPopup(r.id)},dropWorkers(){clearTimeout(this.waitTimeout),this.worker_service.dropWorker(),this.viewportWidth>1200?this.removePercent=!1:this.worker_service.closePopupCard()}},computed:{...T(["getActive","allAccounts","allHash","allHistoryMiner","getAccount","viewportWidth"]),statuses(){return[{title:this.$t("workers.select[0]"),value:"all"},{title:this.$t("workers.select[1]"),value:"active"},{title:this.$t("workers.select[2]"),value:"unstable"}]}},mounted(){this.isMounted=!0,this.instructionService.setStepsCount(2),this.worker_service.setFilterButtons(),this.initWorkers(),document.title=this.$t("header.links.workers")}},Pe={class:"workers"},Ve={class:"workers__wrapper"},Be={class:"workers__content"},xe={class:"workers__table"};function Ee(r,e,s,c,t,o){const n=a("main-title"),_=a("main-hashrate-cards"),d=a("instruction-step"),y=a("worker-tabs"),g=a("main-table"),A=a("main-slider"),S=a("worker-card"),N=a("workers-popup-card"),G=a("instruction-button");return h(),w(P,null,[u("div",Pe,[u("div",Ve,[i(n,{class:"title-worker"},{default:l(()=>[j(m(r.$t("workers.title")),1)]),_:1}),u("div",{class:W(["cards-container onboarding_block",{"onboarding_block-target":t.instructionService.isVisible&&t.instructionService.step===1}])},[i(_,{class:"workers-header-cards"}),i(d,{step_active:1,steps_count:t.instructionService.steps_count,step:t.instructionService.step,"is-visible":t.instructionService.isVisible,text:"texts.workers[0]",title:"titles.workers[0]","class-name":"onboarding__card-top",onNext:e[0]||(e[0]=p=>t.instructionService.nextStep()),onPrev:e[1]||(e[1]=p=>t.instructionService.prevStep()),onClose:e[2]||(e[2]=p=>t.instructionService.nextStep(6))},null,8,["steps_count","step","is-visible"])],2),u("div",Be,[i(y,{tabs:t.worker_service.filterButtons,active_tab:t.worker_service.status,onChangeStatus:o.setStatus},null,8,["tabs","active_tab","onChangeStatus"]),u("div",xe,[i(A,{class:W(["onboarding_block",{"onboarding_block-target":t.instructionService.isVisible&&t.instructionService.step===2}]),wait:t.worker_service.waitWorkers,empty:t.worker_service.emptyTableWorkers,"rows-num":"1000","have-nav":!1},{instruction:l(()=>[i(d,{step_active:2,steps_count:t.instructionService.steps_count,step:t.instructionService.step,"is-visible":t.instructionService.isVisible,text:"texts.workers[1]",title:"titles.workers[1]","class-name":"onboarding__card-bottom",onNext:e[3]||(e[3]=p=>t.instructionService.nextStep()),onPrev:e[4]||(e[4]=p=>t.instructionService.prevStep()),onClose:e[5]||(e[5]=p=>t.instructionService.nextStep(6))},null,8,["steps_count","step","is-visible"])]),default:l(()=>[i(g,{table:t.worker_service.table,"remove-percent":t.removePercent,empty:t.worker_service.emptyTableWorkers,wait:t.worker_service.waitWorkers,onGetData:e[6]||(e[6]=p=>o.getTargetWorker(p))},null,8,["table","remove-percent","empty","wait"])]),_:1},8,["class","wait","empty"]),i(f,{name:"slide"},{default:l(()=>[r.viewportWidth>1200&&t.worker_service.visibleCard?(h(),C(S,{key:0,class:"workers__card",wait:t.worker_service.waitTargetWorker||t.waitAnimation,target_worker:t.worker_service.target_worker,graph:t.worker_service.workers_graph,onCloseCard:o.dropWorkers},null,8,["wait","target_worker","graph","onCloseCard"])):b("",!0)]),_:1})])])])]),r.viewportWidth<=1200?(h(),C(N,{key:0,wait:t.worker_service.wait,closed:t.worker_service.popupCardClosed,opened:t.worker_service.popupCardOpened,onDropWatcher:o.dropWorkers},{default:l(()=>[i(S,{class:"workers__card",target_worker:t.worker_service.target_worker,graph:t.worker_service.workers_graph,wait:t.worker_service.waitTargetWorker,onCloseCard:o.dropWorkers},null,8,["target_worker","graph","wait","onCloseCard"])]),_:1},8,["wait","closed","opened","onDropWatcher"])):b("",!0),t.isMounted?(h(),C(O,{key:1,to:".header_button-instruction"},[i(G,{hint:"workers",onOpenInstruction:e[7]||(e[7]=p=>t.instructionService.setStep().setVisible())})])):b("",!0)],64)}const tt=k(De,[["render",Ee],["__scopeId","data-v-bd16236f"]]);export{tt as default};
