import{m as M,_ as y,o as u,c as h,t as l,n as p,A as m,G as $,H as B,I,P as N,C as d,r as _,a as o,w as g,v as C,F as A,k as S,B as k,g as w,d as f,h as v,b,J as j,q as L,j as O,T as R,p as V,e as F}from"./app-7a3a58ff.js";import{M as H}from"./MainPopup-3ac77bbe.js";import{M as G}from"./MainTitle-5abaae33.js";const K={name:"main-radio",props:{options:Array,getActive:Number},methods:{...M(["getActive"]),checked(){this.$store.dispatch("set_active_in_list",this.options.value)}}};function W(e,s,n,t,c,a){return u(),h("div",{class:p(["radio",{active:n.options.value===n.getActive}]),onClick:s[0]||(s[0]=(...i)=>a.checked&&a.checked(...i))},l(n.options.title),3)}const Z=y(K,[["render",W],["__scopeId","data-v-a77ce256"]]);const q={name:"AccountMenu",components:{MainTitle:G,MainPopup:H,MainRadio:Z},props:{user:{type:Object},is_auth:{type:Boolean,default:!1},viewportWidth:{type:Number,require:!0}},setup(){let e=m(!1),s=m(!1);$.global.t;let n=m(null);const t=B({name:""}),c=async()=>{if(e.value=!0,s.value=!1,t.name.length===0){n.value="empty";return}const a=/^[а-я,А-Я]/;if(t.name.length>15||t.name.length<3||a.test(t.name)){n.value="invalid";return}if(t.name.split(" ").length>1){n.value="no_space";return}try{const i=await N.post(`/subs/create/${d.getters.user.id}`,t);d.dispatch("setNotification",{status:"success",title:"added",text:i.data.message}),s.value=!0,d.dispatch("accounts_all",d.getters.user.id),t.name=""}catch(i){console.error("Error with: "+i),d.dispatch("setFullErrors",i.response.data.errors),d.dispatch("setNotification",{status:"error",title:"error",text:i.response.data.error})}e.value=!1};return I(()=>t.name,(a,i)=>{n.value&&a!==i&&(n.value=null)}),{form:t,addAcc:c,wait:e,closed:s,errorMessage:n}},data(){return{target:!1,open:!1,openedAddPopup:!1,linkAddClicked:!1,name:"..."}},mounted(){this.name=this.getAccount==={}?"...":this.getAccount.name,document.addEventListener("click",this.hideMenuClick,!0),document.addEventListener("keydown",this.hideKey)},unmounted(){document.removeEventListener("click",this.hideMenuClick,!0),document.removeEventListener("keydown",this.hideKey)},computed:{...M(["getIncome","getAccount","allAccounts","getActive","errors"]),accounts(){let e=[];return this.allAccounts&&Object.values(this.allAccounts)[0]&&(e.length=0,Object.values(this.allAccounts).forEach(s=>{e.push({title:s.name,value:s.group_id})})),e},earnSum(){let e=0;return Object.values(this.getIncome).length>0&&Object.values(this.getIncome).forEach(s=>{e+=Number(s.accruals)}),e.toFixed(8)}},watch:{getAccount(e){this.name=e.name},accounts(){this.change_height()},linkAddClicked(e){this.$route.fullPath!=="/profile/accounts"&&e&&(this.linkAddClicked=!1,setTimeout(()=>{this.openedAddPopup=!0},50),setTimeout(()=>{this.openedAddPopup=!1},100))}},methods:{changeActiveAccount(e){this.$store.dispatch("set_active_in_list",{index:e})},async openAddPopup(){this.$route.fullPath!=="/profile/accounts"?(await this.$router.push({name:"accounts"}),this.linkAddClicked=!0,setTimeout(()=>{this.$refs.input.focus()},300)):(this.openedAddPopup=!0,setTimeout(()=>{this.$refs.input.focus()},300),setTimeout(()=>{this.openedAddPopup=!1},100))},change_height(){this.target?this.$nextTick(()=>{const e=this.$refs.menu.scrollHeight;this.$refs.menu.style.maxHeight=`${e}px`,this.viewportWidth<=991.98&&(this.$refs.name.style.marginBottom=`${e+8}px`)}):(this.$refs.menu.style.maxHeight="0",this.viewportWidth<=991.98&&(this.$refs.name.style.marginBottom="0"))},change_index(e){this.$store.dispatch("set_active_in_list",e)},hideKey(e){e.keyCode===27&&this.hideMenu()},hideMenu(){this.target=!1,this.change_height()},hideMenuClick(e){!e.target.closest(".button_name")&&!e.target.closest(".nav__tabs .button .button__row")&&this.hideMenu()},toggleMenu(){this.target=!this.target,this.change_height(),this.target===!0&&(setTimeout(()=>this.open=!0,300),this.$emit("clicked",!0))}}},x=e=>(V("data-v-ae95b7a1"),e=e(),F(),e),D={class:"button_name_text"},U={class:"user-name-text"},z={class:"user-title-text"},J={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},X=x(()=>o("path",{d:"M18 9.00005C18 9.00005 13.5811 15 12 15C10.4188 15 6 9 6 9",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),Q=[X],Y={class:"button__row"},ee={class:"popup-text"},te=["placeholder"],se={type:"submit",class:"all-link blue-button"},oe=x(()=>o("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("path",{d:"M12 22.75C6.07 22.75 1.25 17.93 1.25 12C1.25 9.64 2 7.4 3.42 5.52C3.67 5.19 4.14 5.13 4.47 5.38C4.8 5.63 4.87 6.1 4.62 6.43C3.4 8.04 2.75 9.97 2.75 12C2.75 17.1 6.9 21.25 12 21.25C17.1 21.25 21.25 17.1 21.25 12C21.25 6.9 17.1 2.75 12 2.75C11.59 2.75 11.25 2.41 11.25 2C11.25 1.59 11.59 1.25 12 1.25C17.93 1.25 22.75 6.07 22.75 12C22.75 17.93 17.93 22.75 12 22.75Z"}),o("path",{d:"M12 19.75C7.73 19.75 4.25 16.27 4.25 12C4.25 11.59 4.59 11.25 5 11.25C5.41 11.25 5.75 11.59 5.75 12C5.75 15.45 8.55 18.25 12 18.25C15.45 18.25 18.25 15.45 18.25 12C18.25 8.55 15.45 5.75 12 5.75C11.59 5.75 11.25 5.41 11.25 5C11.25 4.59 11.59 4.25 12 4.25C16.27 4.25 19.75 7.73 19.75 12C19.75 16.27 16.27 19.75 12 19.75Z"}),o("path",{d:"M12 16.75C11.59 16.75 11.25 16.41 11.25 16C11.25 15.59 11.59 15.25 12 15.25C13.79 15.25 15.25 13.79 15.25 12C15.25 10.21 13.79 8.75 12 8.75C11.59 8.75 11.25 8.41 11.25 8C11.25 7.59 11.59 7.25 12 7.25C14.62 7.25 16.75 9.38 16.75 12C16.75 14.62 14.62 16.75 12 16.75Z"})],-1));function ae(e,s,n,t,c,a){const i=_("main-radio"),T=_("main-title"),E=_("main-popup");return u(),h(A,null,[o("div",{class:"button",onClick:s[0]||(s[0]=k((...r)=>a.toggleMenu&&a.toggleMenu(...r),["prevent"]))},[o("div",{ref:"name",class:p(["button_name",{"button_name-target":c.target}])},[o("div",D,[o("p",U,l(c.name),1),o("p",z,l(e.$t("header.user_title")),1)]),g((u(),h("svg",J,Q,512)),[[C,a.accounts.length>1]])],2),g(o("div",{ref:"menu",class:p(["button__menu",{target:c.target}])},[o("div",Y,[(u(!0),h(A,null,S(a.accounts,(r,P)=>(u(),w(i,{key:P,options:r,"get-active":e.getActive,onClick:ne=>a.changeActiveAccount(r.value)},null,8,["options","get-active","onClick"]))),128))])],2),[[C,a.accounts.length>1]])]),(u(),w(R,{to:"body"},[f(E,{id:"addAcc","opened-off":c.openedAddPopup,wait:t.wait,closed:t.closed},{default:v(()=>[o("form",{class:"form form-popup popup__form",onSubmit:s[2]||(s[2]=k((...r)=>t.addAcc&&t.addAcc(...r),["prevent"]))},[f(T,{class:"account-title"},{default:v(()=>[b(l(e.$t("accounts.popups.add.title")),1)]),_:1}),o("p",ee,l(e.$t("accounts.popups.add.text")),1),g(o("input",{ref:"input","onUpdate:modelValue":s[1]||(s[1]=r=>t.form.name=r),autofocus:"",type:"text",class:p(["input popup__input",{"popup__input-error":!!t.errorMessage}]),placeholder:e.$t("accounts.popups.add.placeholders.name")},null,10,te),[[j,t.form.name]]),f(L,{name:"error"},{default:v(()=>[t.errorMessage?(u(),h("span",{key:0,class:p(["error-message",{"error-message-active":!!t.errorMessage}])},l(e.$t(`accounts.popups.add.error.${t.errorMessage}`)),3)):O("",!0)]),_:1}),o("button",se,[oe,b(" "+l(e.$t("accounts.popups.add.button")),1)])],32)]),_:1},8,["opened-off","wait","closed"])]))],64)}const ue=y(q,[["render",ae],["__scopeId","data-v-ae95b7a1"]]);export{ue as A};
