<template>
    <div class="wallets__block wallets__block-wallet">
        <div class="wallets__block_name">
            <div class="wallet-inf">
                <span class="wallet-fullname">{{ wallet.fullName}}</span>
                <span class="wallet-wallet_address">{{ wallet.wallet_address }}</span>
            </div>
            <div class="wallets__block_doths" @click="toggleOpen">
                <div></div>
                <div></div>
                <div></div>
                <main-menu
                    className="wallets__block_doths_menu"
                    :options="options"
                    :opened="opened"
                    @remove="$emit('remove', wallet)"
                    @clicked="changeWalletObj(wallet)"
                ></main-menu>
            </div>
        </div>
        
    </div>
</template>

<script>
import { mapGetters } from "vuex";
import MainMenu from "@/Components/UI/MainMenu.vue";
import { Converter } from "@/Scripts/converter";

export default {
    name: "wallet-block",
    props: {wallet: Object },
    data() {
        return {
            opened: false,
            converter: null,
        };
    },
    components: { MainMenu },
    computed: {
        ...mapGetters(["getActive", "btcInfo"]),
        options() {
            return [
                {
                    name: this.$t("wallets.block.wallet_block.menu[0]"),
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <g clip-path="url(#clip0_427_17514)">
                                <path d="M2.17708 14.6415L2.19015 14.1417H2.19015L2.17708 14.6415ZM1.35755 13.7114L1.85604 13.7503L1.35755 13.7114ZM3.19311 9.29699L2.82569 8.95786L3.19311 9.29699ZM1.37555 13.4804L0.877057 13.4416H0.877057L1.37555 13.4804ZM7.16725 12.7702L6.82039 12.4101L7.16725 12.7702ZM2.36374 14.6464L2.35067 15.1462H2.35067L2.36374 14.6464ZM14.4108 3.58793L14.8522 3.35309L14.4108 3.58793ZM13.4364 6.73199L13.0895 6.37187L13.4364 6.73199ZM14.3804 5.70112L13.946 5.45355L14.3804 5.70112ZM12.4604 1.59553L12.2177 2.03268L12.4604 1.59553ZM9.38264 2.59095L9.75005 2.93007L9.38264 2.59095ZM10.3918 1.6266L10.1362 1.19686L10.3918 1.6266ZM9.02038 2.31376C8.82512 2.1185 8.50854 2.1185 8.31328 2.31376C8.11801 2.50903 8.11801 2.82561 8.31328 3.02087L9.02038 2.31376ZM12.9799 7.68754C13.1752 7.8828 13.4918 7.8828 13.687 7.68754C13.8823 7.49228 13.8823 7.17569 13.687 6.98043L12.9799 7.68754ZM9.3335 14.1673C9.05735 14.1673 8.8335 14.3912 8.8335 14.6673C8.8335 14.9435 9.05735 15.1673 9.3335 15.1673V14.1673ZM14.6668 15.1673C14.943 15.1673 15.1668 14.9435 15.1668 14.6673C15.1668 14.3912 14.943 14.1673 14.6668 14.1673V15.1673ZM13.0895 6.37187L6.82039 12.4101L7.51411 13.1303L13.7832 7.09211L13.0895 6.37187ZM3.56053 9.63611L9.75005 2.93007L9.01521 2.25183L2.82569 8.95786L3.56053 9.63611ZM2.37681 14.1465L2.19015 14.1417L2.16401 15.1413L2.35067 15.1462L2.37681 14.1465ZM1.85604 13.7503L1.87404 13.5193L0.877057 13.4416L0.85906 13.6726L1.85604 13.7503ZM2.19015 14.1417C2.08381 14.1389 1.99957 14.1366 1.92725 14.1329C1.85462 14.1291 1.80703 14.1243 1.77433 14.1188C1.71284 14.1085 1.75878 14.1051 1.80436 14.1568L1.05408 14.8179C1.22104 15.0074 1.43209 15.0755 1.60978 15.1052C1.77194 15.1322 1.97001 15.1362 2.16401 15.1413L2.19015 14.1417ZM0.85906 13.6726C0.843591 13.8711 0.827019 14.0702 0.836209 14.2351C0.846145 14.4134 0.888608 14.6301 1.05408 14.8179L1.80436 14.1568C1.84844 14.2068 1.8385 14.2483 1.83466 14.1794C1.83008 14.0972 1.83836 13.9772 1.85604 13.7503L0.85906 13.6726ZM2.82569 8.95786C2.04177 9.80721 1.56603 10.3132 1.29071 10.9469L2.20789 11.3454C2.40021 10.9027 2.73114 10.5347 3.56053 9.63611L2.82569 8.95786ZM1.87404 13.5193C1.96994 12.2882 2.01519 11.7889 2.20789 11.3454L1.29071 10.9469C1.01577 11.5797 0.967727 12.2778 0.877057 13.4416L1.87404 13.5193ZM6.82039 12.4101C5.79203 13.4005 5.37283 13.7919 4.86363 13.9907L5.22745 14.9222C5.96617 14.6337 6.54546 14.0633 7.51411 13.1303L6.82039 12.4101ZM2.35067 15.1462C3.68131 15.181 4.48761 15.2112 5.22745 14.9222L4.86363 13.9907C4.35554 14.1892 3.78995 14.1835 2.37681 14.1465L2.35067 15.1462ZM13.1396 2.87893C13.6763 3.42728 13.8659 3.62818 13.9694 3.82278L14.8522 3.35309C14.6641 2.99942 14.3415 2.67723 13.8542 2.17939L13.1396 2.87893ZM13.7832 7.09211C14.2846 6.60917 14.6164 6.2967 14.8148 5.94869L13.946 5.45355C13.837 5.64481 13.6419 5.83983 13.0895 6.37187L13.7832 7.09211ZM13.9694 3.82278C14.2408 4.33296 14.2318 4.952 13.946 5.45355L14.8148 5.94869C15.2705 5.14902 15.2846 4.16583 14.8522 3.35309L13.9694 3.82278ZM13.8542 2.17939C13.3675 1.68226 13.0513 1.35169 12.7031 1.15838L12.2177 2.03268C12.4062 2.13735 12.6021 2.32987 13.1396 2.87893L13.8542 2.17939ZM9.75005 2.93007C10.2715 2.36516 10.4618 2.16671 10.6474 2.05634L10.1362 1.19686C9.79386 1.40046 9.48739 1.74025 9.01521 2.25183L9.75005 2.93007ZM12.7031 1.15838C11.8999 0.712465 10.9259 0.727184 10.1362 1.19686L10.6474 2.05634C11.1314 1.76846 11.7259 1.75962 12.2177 2.03268L12.7031 1.15838ZM8.31328 3.02087L12.9799 7.68754L13.687 6.98043L9.02038 2.31376L8.31328 3.02087ZM9.3335 15.1673H14.6668V14.1673H9.3335V15.1673Z" fill="#98A2B3"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_427_17514">
                                <rect width="16" height="16" fill="white"/>
                                </clipPath>
                            </defs>
                            </svg>`,
                    attr: "#changeWallet",
                },
                {
                    name: this.$t("wallets.block.wallet_block.menu[1]"),
                    svg: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M12.5868 10.3507L12.0878 10.3199L12.5868 10.3507ZM13.499 3.69817C13.5161 3.42255 13.3065 3.18531 13.0309 3.16827C12.7552 3.15123 12.518 3.36085 12.501 3.63647L13.499 3.69817ZM3.49909 3.63719C3.48245 3.36155 3.24551 3.15159 2.96987 3.16823C2.69423 3.18487 2.48427 3.42181 2.50091 3.69745L3.49909 3.63719ZM3.40307 10.3441L3.90216 10.314L3.40307 10.3441ZM12.0005 13.5259L12.4106 13.8119V13.8119L12.0005 13.5259ZM11.2005 14.278L10.9403 13.851H10.9403L11.2005 14.278ZM3.98579 13.5239L4.39619 13.2383L4.39619 13.2383L3.98579 13.5239ZM4.78604 14.2773L5.04639 13.8504L4.78604 14.2773ZM2 3.16732C1.72386 3.16732 1.5 3.39118 1.5 3.66732C1.5 3.94346 1.72386 4.16732 2 4.16732V3.16732ZM14 4.16732C14.2761 4.16732 14.5 3.94346 14.5 3.66732C14.5 3.39118 14.2761 3.16732 14 3.16732V4.16732ZM10.2487 2.72847L9.79878 2.94657L9.79878 2.94657L10.2487 2.72847ZM5.7724 2.78149L6.22737 2.98888L5.7724 2.78149ZM6.4782 1.60943L6.78254 2.00614L6.78254 2.00614L6.4782 1.60943ZM6.66379 1.49006L6.42905 1.04859V1.04859L6.66379 1.49006ZM9.53448 1.59852L9.83341 1.19772L9.83341 1.19772L9.53448 1.59852ZM9.35135 1.48379L9.12109 1.92761V1.92761L9.35135 1.48379ZM5.83333 11.0007C5.83333 11.2768 6.05719 11.5007 6.33333 11.5007C6.60948 11.5007 6.83333 11.2768 6.83333 11.0007H5.83333ZM6.83333 7.00065C6.83333 6.72451 6.60948 6.50065 6.33333 6.50065C6.05719 6.50065 5.83333 6.72451 5.83333 7.00065H6.83333ZM9.16667 11.0007C9.16667 11.2768 9.39052 11.5007 9.66667 11.5007C9.94281 11.5007 10.1667 11.2768 10.1667 11.0007H9.16667ZM10.1667 7.00065C10.1667 6.72451 9.94281 6.50065 9.66667 6.50065C9.39052 6.50065 9.16667 6.72451 9.16667 7.00065H10.1667ZM13.0859 10.3816L13.499 3.69817L12.501 3.63647L12.0878 10.3199L13.0859 10.3816ZM2.50091 3.69745L2.90398 10.3742L3.90216 10.314L3.49909 3.63719L2.50091 3.69745ZM12.0878 10.3199C12.0344 11.1833 11.996 11.7957 11.9208 12.2701C11.8468 12.7366 11.7437 13.02 11.5904 13.2399L12.4106 13.8119C12.6853 13.418 12.8226 12.9676 12.9084 12.4268C12.9929 11.894 13.0337 11.2256 13.0859 10.3816L12.0878 10.3199ZM7.99516 15.1673C8.84086 15.1673 9.51047 15.1679 10.0474 15.1164C10.5925 15.0641 11.0505 14.9548 11.4606 14.705L10.9403 13.851C10.7114 13.9905 10.4221 14.0759 9.95201 14.1209C9.47381 14.1668 8.8603 14.1673 7.99516 14.1673V15.1673ZM11.5904 13.2399C11.4184 13.4865 11.1971 13.6946 10.9403 13.851L11.4606 14.705C11.8358 14.4764 12.1593 14.1723 12.4106 13.8119L11.5904 13.2399ZM2.90398 10.3742C2.95501 11.2195 2.99488 11.8888 3.07876 12.4223C3.1639 12.9639 3.30079 13.4149 3.57539 13.8095L4.39619 13.2383C4.24291 13.018 4.14006 12.7341 4.06662 12.267C3.99192 11.7918 3.95436 11.1787 3.90216 10.314L2.90398 10.3742ZM7.99516 14.1673C7.12889 14.1673 6.51456 14.1668 6.03575 14.1208C5.56504 14.0757 5.27548 13.9901 5.04639 13.8504L4.52568 14.7041C4.93609 14.9545 5.39456 15.0639 5.94026 15.1163C6.47787 15.1679 7.14835 15.1673 7.99516 15.1673V14.1673ZM3.57539 13.8095C3.82659 14.1705 4.15023 14.4751 4.52568 14.7041L5.04639 13.8504C4.7895 13.6937 4.56807 13.4853 4.39619 13.2383L3.57539 13.8095ZM2 4.16732H5.36862V3.16732H2V4.16732ZM5.36862 4.16732H10.7038V3.16732H5.36862V4.16732ZM10.7038 4.16732H14V3.16732H10.7038V4.16732ZM9.79878 2.94657L10.2539 3.88542L11.1537 3.44921L10.6986 2.51036L9.79878 2.94657ZM5.31744 2.5741L4.91365 3.45993L5.82358 3.8747L6.22737 2.98888L5.31744 2.5741ZM6.22737 2.98888C6.37843 2.65747 6.4784 2.43931 6.57118 2.2767C6.65925 2.12234 6.72244 2.05224 6.78254 2.00614L6.17386 1.21272C5.97018 1.36897 5.82782 1.56167 5.70261 1.78114C5.5821 1.99235 5.46106 2.25904 5.31744 2.5741L6.22737 2.98888ZM8.02302 0.833984C7.67677 0.833984 7.3839 0.833507 7.14172 0.855553C6.89009 0.878461 6.6557 0.928076 6.42905 1.04859L6.89853 1.93153C6.96541 1.89597 7.0554 1.86755 7.23238 1.85144C7.41883 1.83446 7.6588 1.83398 8.02302 1.83398V0.833984ZM6.78254 2.00614C6.81907 1.97811 6.85787 1.95315 6.89853 1.93153L6.42905 1.04859C6.3396 1.09616 6.25424 1.15105 6.17386 1.21272L6.78254 2.00614ZM10.6986 2.51036C10.5513 2.20646 10.427 1.94903 10.3047 1.74524C10.1776 1.53343 10.0346 1.34782 9.83341 1.19772L9.23554 1.99932C9.29505 2.04371 9.35808 2.11124 9.4473 2.25988C9.54132 2.41653 9.64378 2.62683 9.79878 2.94657L10.6986 2.51036ZM8.02302 1.83398C8.37835 1.83398 8.61228 1.83445 8.79426 1.85072C8.96693 1.86616 9.05519 1.89342 9.12109 1.92761L9.58161 1.03996C9.35877 0.924348 9.12939 0.876704 8.88335 0.854697C8.64661 0.833524 8.36074 0.833984 8.02302 0.833984V1.83398ZM9.83341 1.19772C9.75388 1.13841 9.66967 1.08565 9.58161 1.03996L9.12109 1.92761C9.16112 1.94838 9.19939 1.97236 9.23555 1.99932L9.83341 1.19772ZM6.83333 11.0007L6.83333 7.00065H5.83333L5.83333 11.0007H6.83333ZM10.1667 11.0007V7.00065H9.16667V11.0007H10.1667Z" fill="#98A2B3"/>
                        </svg>`,
                    class: "remove",
                    attr: "#removeWallet",
                },
            ];
        },
    },
    async mounted() {
        document.addEventListener("click", this.close.bind(this), true);
        document.addEventListener("keydown", (e) => {
            if (e.keyCode === 27) {
                this.close();
            }
        });
    },
    unmounted() {
        // document.removeEventListener("click", this.hideSelect.bind(this), true);
        document.removeEventListener("keydown", (e) => {
            if (e.keyCode === 27) {
                this.close();
            }
        });
    },
    created() {
        this.updateConversion();
    },
    watch: {
        btcInfo: {
            immediate: true,
            handler() {
                this.updateConversion();
            },
        },
        "wallet.value": {
            immediate: true,
            handler() {
                this.updateConversion();
            },
        },
    },
    methods: {
        async updateConversion() {
            this.converter = new Converter(
                this.wallet.total_payout,
                this.btcInfo?.btc ? this.btcInfo.btc.price : 0
            );
            await this.converter.convert();
        },
        toggleOpen() {
            this.opened = !this.opened;
        },
        close(e) {
            if (!e?.target.closest(".wallets__block_doths")) {
                this.opened = false;
            }
        },
        changeWalletObj(wallet) {
            this.$emit("getWallet", wallet);
        },
    },
};
</script>

<style scoped lang="scss">
.wallet-inf{
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.wallet-wallet_address{
    color: var(--light-gray-400, #98A2B3);
    font-family: NunitoSans;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 145%; /* 20.3px */
}
.wallet-fullname{
    color: var(--light-gray-500, #667085);
    font-family: Unbounded;
    font-size: 16px;
    font-style: normal;
    font-weight: 400;
    line-height: 150%; /* 24px */
}
.wallets {
    // .wallets__block
    &__block {
        border-radius: 24px;
        background: var(--light-background-first, #F8FAFD);
        box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.01);
        .main__number {
            padding: 16px 16px 0;
            margin-bottom: 8px;
            font-size: 20px;
            line-height: 28px;
            width: 100%;
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            font-weight: 500;
            color: #343434;
            .unit {
                font-weight: 500;
            }
            @media (max-width: 767.98px) {
                font-size: 18px;
                padding: 10px 10px 0;
                line-height: 23px;
                margin-bottom: 0;
                .unit {
                    font-weight: 500;
                }
            }
            span {
                padding: 0 16px;
            }
        }

        &-wallet {
            transition: all 0.5s ease;

            &.top {
                &-before-enter {
                    opacity: 0;
                }

                &-enter {
                    opacity: 1;
                }
            }
        }

        &_name {
            width: 100%;
            padding: 16px 24px;
            display: inline-flex;
            align-items: center;
            gap: 16px;
            @media (max-width: 767.98px) {
                padding: 0 10px 10px;
            }

            img {
                margin-right: 16px;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                @media (max-width: 767.98px) {
                    margin-right: 6px;
                }
            }

            span {
                font-weight: 500;
                font-size: 18px;
                line-height: 26px;
                @media (max-width: 991.98px) {
                    font-size: 16px;
                    line-height: 23px;
                }
            }
        }

        &_i {
            position: absolute;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            right: 12px;
            bottom: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #eff2f7;
            cursor: pointer;
            svg {
                width: 4px;
                height: 12px;
            }
        }

        &_doths {
            margin-left: auto;
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 24px;
            gap: 3px;
            cursor: pointer;
            position: relative;
            @media (max-width: 767.98px) {
                width: 20px;
                gap: 2.5px;
            }

            div {
                width: 4px;
                height: 4px;
                border-radius: 50%;
                background-color: rgba(0, 0, 0, 0.62);
                transition: all 0.3s ease;
            }
        }
    }
}
</style>
